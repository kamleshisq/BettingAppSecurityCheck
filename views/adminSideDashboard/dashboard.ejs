<%- include("../header") %>
<div class="dashboard-main-wraper">
  <section class="dashboard-welcome-section">
    <div class="new-head"> 
        <h3>Dashboard</h3>
    </div>
  <%- include("../loginUserAdminsideDetails") %>
</section>
<section class="dashboard-main-grid">
  <div class="grid-2">
    <div class="chart inner-box-grid"> <div id="chart"></div> </div>
    <div class="chart-right">
        <div class="grid-2 summary-user-man">
          
          <div class="inner-box-grid user-managment">
            <div class="hed-data">
              <h3 class="fix-h3"><svg xmlns="http://www.w3.org/2000/svg" width="19" height="20" viewBox="0 0 19 20" fill="none">
                <path d="M18.7 12.35L17.7 13.35L15.65 11.35L16.65 10.35C16.85 10.14 17.19 10.13 17.42 10.35L18.7 11.63C18.89 11.83 18.89 12.15 18.7 12.35ZM9 17.94V20H11.06L17.12 13.88L15.07 11.88L9 17.94ZM2 18H7V20H2C1.46957 20 0.960859 19.7893 0.585786 19.4142C0.210714 19.0391 0 18.5304 0 18V4C0 2.9 0.9 2 2 2H3V0H5V2H13V0H15V2H16C16.5304 2 17.0391 2.21071 17.4142 2.58579C17.7893 2.96086 18 3.46957 18 4V8H2V18ZM2 4V6H16V4H2Z" fill="#6359CA"/>
                </svg> User Management</h3>
              <a class="fix-h2" href="/admin/userManagement">View Details</a>
          </div>
          <table>
            <thead>
                <th>User Type</th>
                <th>Total</th>
            </thead>
            <tbody>
                <%for(let i=0; i < data.dashboard.roles.length;i++){%>
                  <%if((i % 2) == 0){%>
                    <tr class="flex-justify blue">
                        <td><%=data.dashboard.roles[i]._id%></td>
                        <td class="text-purple"><%=data.dashboard.roles[i].total%></td>
                    </tr>
                    <%}else{%>
                      <tr class="flex-justify">
                        <td><%=data.dashboard.roles[i]._id%></td>
                        <td class="text-purple"><%=data.dashboard.roles[i].total%></td>
                      </tr>
                    <%}%>
                <%}%>
            </tbody>
          </table>
          </div>
      
        </div>
        <div class="grid-1">
          <div class="inner-box-grid white-labels">
            <div class="hed-data">
              <h3 class="fix-h3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="19" viewBox="0 0 20 19" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M18 0.5H2C0.9 0.5 0 1.4 0 2.5V16.5C0 17.6 0.9 18.5 2 18.5H18C19.1 18.5 20 17.6 20 16.5V2.5C20 1.4 19.1 0.5 18 0.5ZM7 14.5H4C3.45 14.5 3 14.05 3 13.5C3 12.95 3.45 12.5 4 12.5H7C7.55 12.5 8 12.95 8 13.5C8 14.05 7.55 14.5 7 14.5ZM7 10.5H4C3.45 10.5 3 10.05 3 9.5C3 8.95 3.45 8.5 4 8.5H7C7.55 8.5 8 8.95 8 9.5C8 10.05 7.55 10.5 7 10.5ZM7 6.5H4C3.45 6.5 3 6.05 3 5.5C3 4.95 3.45 4.5 4 4.5H7C7.55 4.5 8 4.95 8 5.5C8 6.05 7.55 6.5 7 6.5ZM16.7 8.62L13.53 11.79C13.14 12.18 12.5 12.18 12.11 11.79L10.7 10.37C10.6074 10.2774 10.534 10.1675 10.4839 10.0465C10.4338 9.92558 10.408 9.79593 10.408 9.665C10.408 9.53407 10.4338 9.40442 10.4839 9.28346C10.534 9.16249 10.6074 9.05258 10.7 8.96C10.7926 8.86742 10.9025 8.79398 11.0235 8.74387C11.1444 8.69377 11.2741 8.66798 11.405 8.66798C11.5359 8.66798 11.6656 8.69377 11.7865 8.74387C11.9075 8.79398 12.0174 8.86742 12.11 8.96L12.82 9.67L15.29 7.2C15.3825 7.1073 15.4924 7.03375 15.6134 6.98357C15.7344 6.93339 15.864 6.90756 15.995 6.90756C16.126 6.90756 16.2557 6.93339 16.3766 6.98357C16.4976 7.03375 16.6075 7.1073 16.7 7.2L16.71 7.21C17.09 7.6 17.09 8.24 16.7 8.62Z" fill="#6359CA"/>
                </svg> White Labels</h3>
            </div>
            <div class="full-data">
              <table>
                <thead>
                  <tr>
                    <th>Sr No.</th>
                    <th>Domain</th>
                    <%for(let i=0; i<data.dashboard.roles.length;i++){%>
                        <th><%=data.dashboard.roles[i]._id%></th>
                    <%}%>
                  </tr>
                </thead>
                <tbody>
                  <%for(let i=0; i<data.dashboard.users.length;i++){%>
                    <%if((i % 2) == 0){%>
                      <tr>
                          <td data-title="Sr No."><%=i + 1%></td>
                          <td data-title="Domain"><%=data.dashboard.users[i]._id%></td>
                          <%for(let j=0; j<data.dashboard.roles.length;j++){%>
                              <%let check = 0%>
                              <%for(let k=0; k<data.dashboard.users[i].terms.length;k++){%>
                                  <%if(data.dashboard.users[i].terms[k].roleType == data.dashboard.roles[j]._id){%>
                                      <td data-title="<%=data.dashboard.roles[j]._id%>" class="text-purple"><%=data.dashboard.users[i].terms[k].total%></td>
                                      <%check = 1%>
                                  <%}%>
                              <%}%>
                              <%if(check != 1){%>
                                  <td  data-title="<%=data.dashboard.roles[j]._id%>" class="text-purple">0</td>
                              <%}%>
                          <%}%>
                      </tr>
                    <%}else{%>
                      <tr  >
                        <td data-title="Sr No." > <%=i + 1%></td>
                        <td data-title="Domain" ><%=data.dashboard.users[i]._id%></td>
                        <%for(let j=0; j<data.dashboard.roles.length;j++){%>
                            <%let check = 0%>
                            <%for(let k=0; k<data.dashboard.users[i].terms.length;k++){%>
                                <%if(data.dashboard.users[i].terms[k].roleType == data.dashboard.roles[j]._id){%>
                                    <td data-title="<%=data.dashboard.roles[j]._id%>" class="text-purple"><%=data.dashboard.users[i].terms[k].total%></td>
                                    <%check = 1%>
                                <%}%>
                            <%}%>
                            <%if(check != 1){%>
                                <td data-title="<%=data.dashboard.roles[j]._id%>" class="text-purple">0</td>
                            <%}%>
                        <%}%>
                    </tr>
                    <%}%>
                  <%}%>
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </div>
   
  </div>

</section>
</div>
    

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.40.0/dist/apexcharts.min.js"></script>
<script src="../js/bundle.js"></script>
<script>
  const selectedAll = document.querySelectorAll(".wrapper-dropdown");

selectedAll.forEach((selected) => {
  const optionsContainer = selected.children[2];
  const optionsList = selected.querySelectorAll("div.wrapper-dropdown li");

  selected.addEventListener("click", () => {
    let arrow = selected.children[1];

    if (selected.classList.contains("active")) {
      handleDropdown(selected, arrow, false);
    } else {
      let currentActive = document.querySelector(".wrapper-dropdown.active");

      if (currentActive) {
        let anotherArrow = currentActive.children[1];
        handleDropdown(currentActive, anotherArrow, false);
      }

      handleDropdown(selected, arrow, true);
    }
  });

  // update the display of the dropdown
  for (let o of optionsList) {
    o.addEventListener("click", () => {
      selected.querySelector(".selected-display").innerHTML = o.innerHTML;
    });
  }
});

// check if anything else ofther than the dropdown is clicked
window.addEventListener("click", function (e) {
  if (e.target.closest(".wrapper-dropdown") === null) {
    closeAllDropdowns();
  }
});

// close all the dropdowns
function closeAllDropdowns() {
  const selectedAll = document.querySelectorAll(".wrapper-dropdown");
  selectedAll.forEach((selected) => {
    const optionsContainer = selected.children[2];
    let arrow = selected.children[1];

    handleDropdown(selected, arrow, false);
  });
}

// open all the dropdowns
function handleDropdown(dropdown, arrow, open) {
  if (open) {
    arrow.classList.add("rotated");
    dropdown.classList.add("active");
  } else {
    arrow.classList.remove("rotated");
    dropdown.classList.remove("active");
  }
}

</script>
  </body>
</html>